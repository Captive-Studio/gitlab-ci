# Common pipelines variables
#
# Guidelines
#
# ✓ Variables should be `UPPER_UNDERSCORE_CASE`
# ✓ Toggle variables should always use `_ENABLED` (not `_DISABLED`)
# ✓ Each Variables should be documented
variables:
  # Application name (for deployment, packages, etc)
  # By default $CI_PROJECT_NAME is used.
  #
  # @example
  # URL: https://git.captive.fr/captive/my-project
  # $CI_PROJECT_NAME // 'my-project'
  #
  # @type {string}
  APP_NAME: $CI_PROJECT_NAME

  # Default domain for deployment `env.app.$APP_DOMAIN`
  #
  # @type {string}
  APP_DOMAIN: captive.dev

  # Enable Build step
  #
  # @type {'true'|''}
  BUILD_ENABLED: 'true'

  # Enable Code quality (lint, rubocop, audit, etc)
  #
  # @type {'true'|''}
  CODE_QUALITY_ENABLED: 'true'

  # Enable Test step
  #
  # @type {'true'|''}
  TEST_ENABLED: 'true'

  # Enable Test system step
  #
  # @type {'true'|''}
  TEST_SYSTEM_ENABLED: 'true'

  # Enable Review step
  #
  # @type {'true'|''}
  REVIEW_ENABLED: 'true'

  # Deploy to staging step
  #
  # @type {'true'|''}
  STAGING_ENABLED: 'true'

  # Deploy canary release
  #
  # @type {'true'|''}
  CANARY_ENABLED: ''

  # Incremental rollout release (10%, 20%, etc)
  #
  # @type {'true'|''}
  INCREMENTAL_ROLLOUT_ENABLED: ''

  # Deployment Platform Target
  #
  # @type {''| 'HEROKU' | 'SCALINGO' | 'SCALEWAY' | 'MAKEFILE'}
  AUTO_DEVOPS_PLATFORM_TARGET: ''

  # Docker image registry URL, where image are pushed
  #
  # Can be overridden in Gitlab Projects and Groups
  #
  # @type {string}
  CONTAINER_REGISTRY: registry.git.captive.fr

  # Docker image registry URL mirror (used by .docker-dind), to avoid limitation
  # By default we use google mirror (https://mirror.gcr.io) to ensure this configuration works in most environments
  #
  # Can be overridden in Gitlab Projects and Groups
  #
  # @type {string}
  CONTAINER_REGISTRY_MIRROR: https://mirror.gcr.io

  # Required variables for docker.mk
  #
  # @type {string}
  REGISTRY_PROJECT_URL: $CONTAINER_REGISTRY/$CI_PROJECT_PATH

  BUILD_SUBPATH: dev
  BUILD_ID: $CI_COMMIT_SHORT_SHA
  REF_ID: $CI_COMMIT_REF_SLUG

  #
  # docker-dind
  #

  # @internal Use driver overlay2 for performances
  DOCKER_DRIVER: overlay2

  # @internal Disable TLS
  DOCKER_TLS_CERTDIR: ''

  # @internal
  DEPLOY_SSH_KNOWN_HOSTS_BASE64: ''

  #
  # Postgres
  #
  POSTGRES_DB: ci_test
  POSTGRES_USER: ci_db_user
  POSTGRES_PASSWORD: ci_db_password
  DATABASE_URL: 'postgresql://$POSTGRES_USER:$POSTGRES_PASSWORD@postgres:5432/$POSTGRES_DB'

  #
  # Redis
  #
  REDIS_URL: redis://redis:6379

  #
  # NodeJS
  #

  # NodeJS version used (with `image: cimg/node-${NODEJS_VERSION}`)
  #
  # @see https://circleci.com/developer/images/image/cimg/node
  NODEJS_VERSION: 19.5.0

  #
  # Ruby
  #

  # NodeJS version used (with `image: cimg/ruby-${NODEJS_VERSION}`)
  #
  # @see https://circleci.com/developer/images/image/cimg/ruby
  RUBY_VERSION: 3.2.0
