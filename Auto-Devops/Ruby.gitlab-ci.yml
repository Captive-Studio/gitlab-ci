
.ruby_present_rule: &ruby_present_rule
  exists:
    - Gemfile

# FIXME: .code_quality "except" conflicts with "rules"
# except:
#   - /^backup\//

ruby:check-tools:
  extends:
    - .code_quality
  script:
    - controle-qualite.mk self-check-ruby
  rules:
    - <<: *ruby_present_rule
  allow_failure: true

ruby:rubocop:
  extends:
    - .code_quality
  script:
    - controle-qualite.mk rubocop
  rules:
    - exists:
        - .rubocop.yml

ruby:bundle-audit:
  extends:
    - .code_quality
  script:
    - controle-qualite.mk bundle-audit
  rules:
    - <<: *ruby_present_rule
  allow_failure: true

ruby:brakeman:
  extends:
    - .code_quality
  script:
    - controle-qualite.mk brakeman
  rules:
    - <<: *ruby_present_rule
  allow_failure: true
